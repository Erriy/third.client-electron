# third.client-electron

## 代码逻辑介绍

> 略，稍后功能稳定后补充，目前改动较大


## 使用方法

### 安装环境

``` shell
npm install
```

### 调试启动

> 涉及到electron的api调用，不能使用浏览器调试
>
> 修改electron的窗口加载url在`app/window.js@create`中，
>
> - win.loadURL(`http://localhost:8080/#${path}`);


``` shell
# 启动vue调试服务
npm run dv
# 调试启动electron，自动加载本地8080端口
npm run de
```


### 构建可发布应用

``` shell
# 生成位置在dist目录下
npm run build
```

## todo

- [ ] 主页/搜索
  - [ ] 信任链、信任链查询
  - [ ] 按标签搜索（包括多标签交并集搜索）
  - [ ] 高级查询表达式
  - [ ] 导入导出
  - [ ] 上传队列进度展示
  - [ ] 支持思维导图式展现[mindmap](https://github.com/hellowuxin/mindmap)
- [ ] 内容编辑
  - [ ] 多编辑器支持
    - [ ] [ckeditor5](https://github.com/ckeditor/ckeditor5)
    - [ ] [monaco-editor](https://github.com/Microsoft/monaco-editor)
  - [ ] 添加标签和与标签的关系
  - [ ] 添加附属节点和与节点的关系
  - [ ] 历史版本展示
  - [ ] 文件上传（图片、音频、视频、word、excel等文本/非文本数据）
- [ ] 管理员后台
  - [ ] 系统状态统计信息
    - [ ] 用户统计
    - [ ] 节点统计
  - [ ] 用户管理
    - [ ] 举报接口
    - [ ] 添加到允许列表
    - [ ] 添加到屏蔽列表
  - [ ] 备份
  - [ ] 同步拉取数据
  - [ ] 敏感词设置
- [ ] 浏览器插件
- [ ] 服务器相关
  - [ ] 删除服务器历史
  - [ ] 内网服务自发现
    - [ ] mdns发现采用text，内容包括信任信息（比如接口证书指纹，连接时验证即可）
  - [ ] 服务器优先级配置，自动按优先级使用服务接口
- [ ] 其他
  - [ ] 第一次打开时展示帮助文档
  - [ ] 自动更新
  - [ ] 剪贴板管理
  - [ ] 网盘功能（文件监听/映射）
  - [ ] 多平台支持
    - [ ] linux 应用发布（pacman）
    - [ ] 应用单开互不影响
    - [ ] 数据库互不影响
    - [ ] 证书调用本地gpg
- [ ] 安全问题
  - [ ] 不使用openpgpjs，直接调用gpg，使用gpg客户端进行身份管理
  - [ ] 使用keyring存储密码


## 客户端逻辑

- 网关
  - 虚拟磁盘
  - 文件上传
  - 自动调用相关编辑器
  - 文件查找
  - 协同编辑
- [ ] 单进程模式
  - [ ] 选择服务器
  - [ ] 选择用户
  - [ ] 保存内容
  - [ ] 查找内容
- [ ] 大块数据（图片、视频等）保存到本地/oss，云端保存索引和关系，指向本地存储的空间
  - [ ] 备份，自行备份数据或者实用工具即可（或备份到oss）

## 正在做的事情

- [ ] 保存后进行合并操作，提醒冲突
- [x] 使用其他应用打开（nodejs - open）
  - [ ] 生成本地临时文件，调用其他应用打开，操作完成后删除
- [x] 检测依赖应用是否安装，检测优先支持的应用（通过路径或命令）
  - [ ] gpg（命令是否存在）
  - [ ] typora（路径）
- [ ] 阅读器模式
  - [ ] rss自动采集（server端）
  - [ ] 阅读，添加标签
- [ ] 编辑器模式
  - [ ] 修改编辑

- 类subkey机制

> 配置后应在所有的在用服务器上更新一遍config
> 公开的是profile，私有的信任数据是config

  - config文件中设置信任的证书的访问权限，允许某些人进行某些修改（拒绝接收比已有profile时间早的信息，防止信任降级）
  - config中包括信任的服务器证书指纹
  - 设备连接时使用设备key，去config中查看是否允许访问
  - 设备key，仅用作设备认证使用，不认可其签名数据
  - 公开数据必须使用身份证书进行签名
  - 单seed可使用config配置访问权限


## 2021-01-17

- [x] 简单列表页
- [x] 删除数据

## 2021-01-18

- [ ] ci自动构建

## 2021-01-19

- [ ] 自动更新

## 2021-01-20

- [ ] 使用nodejs构建服务端

## 存储计划

> 访问时访问thubnail，本地保存源文件，oss冷备份同步所有源文件